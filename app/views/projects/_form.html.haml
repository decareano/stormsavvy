= nested_form_for @project, :html => { :class => "form-horizontal"} do |f|
  -if @project.errors.any?
    #error_explanation
      %h2= "#{pluralize(@project.errors.count, "error")} prohibited this project from being saved:"
      %ul
        - @project.errors.full_messages.each do |msg|
          %li= msg

  %fieldset
    %legend Project Details
    .control-group
      = f.label :name, :class => "control-label"
      .controls
        = f.text_field :name
    .control-group
      = f.label :description, :class => "control-label"
      .controls
        = f.text_area :description, :rows => "5"

    .control-group
      = f.label :startdate, :class => "control-label"
      .controls
        = f.text_field :startdate, :class => "datePicker"

    .control-group
      = f.label :finishdate, :class => "control-label"
      .controls
        = f.text_field :finishdate, :class => "datePicker"
    .control-group

      = f.label :active, :class => "control-label"
      .controls
        = f.check_box :active

  %fieldset
    %legend
      Site Details
      = f.fields_for :sites, do |site|
        = site.object.state
        .control-group
          = site.label :name, :class => "control-label"
          .controls
            = site.text_field :name
        .control-group
          = site.label :description, :class => "control-label"
          .controls
            = site.text_area :description, :rows => "5"

        .control-group
          = site.label :costcode, :class => "control-label"
          .controls
            = site.text_field :costcode

        .control-group
          =site.label :address_1, :class => "control-label"
          .controls
            = site.text_field :address_1

        .control-group
          =site.label :address_2, :class => "control-label"
          .controls
            = site.text_field :address_2

        .control-group
          =site.label :city, :class => "control-label"
          .controls
            = site.text_field :city

        .control-group
          =site.label :state, :class => "control-label"
          .controls
            = site.select :state, Carmen.states, {:include_blank => true}, :selected => site.object.state

        .control-group
          =site.label :zipcode, :class => "control-label"
          .controls
            = site.text_field :zipcode

        = site.link_to_remove "Remove this site"

      = f.link_to_add "Add a new site", :sites


  .actions
    = f.submit 'Save', :class => "btn btn-primary"
